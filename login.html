<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Login</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background-color: #1C1C1E;
    color: #f2f2f2;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .box {
    background: #2A2A2D;
    border-radius: 14px;
    padding: 28px 26px 32px 26px;
    width: 320px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    text-align: center;
  }
  .logo {
    background: #D81B60;
    color: white;
    font-weight: bold;
    font-size: 1.6em;
    padding: 10px 0;
    border-radius: 50px;
    width: 160px;
    margin: 0 auto 15px auto;
    box-shadow: 0 0 10px rgba(216,27,96,0.5);
  }
  .subtitle {
    font-size: 1em;
    color: #aaa;
    margin-bottom: 20px;
  }
  input {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border: none;
    border-radius: 6px;
    background: #3A3A3D;
    color: #f2f2f2;
  }
  input::placeholder {
    color: #999;
  }
  button {
    width: 100%;
    padding: 10px;
    background: #D81B60;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
  }
  button:hover {
    background: #E91E63;
  }
  .msg { margin-top: 10px; color: rgb(0,200,0); }
  .err { margin-top: 10px; color: rgb(255,80,80); }
</style>
</head>

<body>
  <div class="box">
    <div class="logo">MATBEO</div>
    <div class="subtitle">Jelentkezz be</div>
    <input id="user" placeholder="Felhasználó kód (pl. ABC)" autocomplete="username" />
    <input id="pwd" placeholder="Jelszó" type="password" autocomplete="current-password" inputmode="numeric" />
    <button id="btn">Bejelentkezés</button>
    <div id="out" class="msg"></div>
  </div>

<script>
// --- jelszó "tükrözéses" obfuszkáció ---
function obfSimpleJS(s) {
  const A = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  const a = "abcdefghijklmnopqrstuvwxyz";
  const revA = A.split("").reverse().join("");
  const reva = a.split("").reverse().join("");
  let out = "";
  for (let i = 0; i < s.length; i++) {
    const ch = s[i];
    const idxU = A.indexOf(ch);
    const idxL = a.indexOf(ch);
    if (idxU !== -1) out += revA[idxU];
    else if (idxL !== -1) out += reva[idxL];
    else if (/[0-9]/.test(ch)) out += String(9 - parseInt(ch, 10));
    else out += ch;
  }
  return out;
}

// --- userlist betöltése ---
let userlist = {};
async function loadUserlist() {
  try {
    const res = await fetch('userlist.json', {cache: "no-store"});
    if (!res.ok) throw new Error('userlist not found');
    userlist = await res.json();
  } catch (e) {
    console.warn('Nem sikerült betölteni a userlist.json-t:', e);
    userlist = {};
  }
}
loadUserlist();

// --- automatikus kijelentkezés 10 perc inaktivitás után ---
let logoutTimer;
function resetTimer() {
  clearTimeout(logoutTimer);
  logoutTimer = setTimeout(() => {
    localStorage.removeItem('loggedUser');
    alert("10 perc inaktivitás után automatikus kijelentkezés.");
    location.href = 'login.html';
  }, 10 * 60 * 1000); // 10 perc
}
['click','keydown','mousemove','touchstart'].forEach(e =>
  document.addEventListener(e, resetTimer)
);
resetTimer();

// --- bejelentkezés logika ---
document.getElementById('btn').addEventListener('click', async function(){
  const u = document.getElementById('user').value.trim().toUpperCase();
  const p = document.getElementById('pwd').value.trim();
  const out = document.getElementById('out');
  if (!u || !p) { out.className='err'; out.textContent='Adj meg felhasználót és jelszót.'; return; }
  if (!userlist) await loadUserlist();
  const stored = userlist[u];
  if (!stored) { out.className='err'; out.textContent='Nincs ilyen felhasználó.'; return; }

  const obf = obfSimpleJS(p);
 if (obf === stored) {
  out.className = 'msg';
  out.textContent = 'Sikeres bejelentkezés — hozzáférés engedélyezve.';
  localStorage.setItem('loggedUser', u);

  setTimeout(() => {
  // mindig a legfrissebb dátumos mappába irányít
  // (az a mappa, ami a legutóbb feltöltött safeDate a GitHubon)
  // pl. "15-OCT-2025"
  const today = new Date();
  const day = String(today.getDate()).padStart(2, '0');
  const month = today.toLocaleString('en-GB', {month: 'short'}).toUpperCase();
  const year = today.getFullYear();
  const currentFolder = `${day}-${month}-${year}`;

  // irányítás a felhasználó saját oldalára
  const target = `${currentFolder}/${u}_${currentFolder}.html`;
  window.location.href = target;
}, 1000);
} else {
    out.className='err'; out.textContent='Hibás jelszó.';
  }
});
</script>
</body>
</html>